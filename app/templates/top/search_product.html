{% extends "base.html" %}
{% block title %}
    検索結果: {{ search_query or "すべて" }} 
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/search_product.css') }}">
  <div class="breadcrumb">
    <a href="{{ url_for('top.guest_index') }}">SubKari</a> &gt; 検索結果
  </div>
  <div class="container">
    <aside class="sidebar">
      <div class="filter-section">
        <div class="filter-title">種別</div>
        <div class="filter-options">
          <label class="filter-option"><input type="radio" name="type" checked> ユニセックス</label>
          <label class="filter-option"><input type="radio" name="type"> レディース</label>
        </div>
      </div>

      <div class="filter-section">
        <div class="filter-title">カテゴリ</div>
        <div class="filter-options">
          <label class="filter-option"><input type="checkbox"> コート</label>
          <label class="filter-option"><input type="checkbox" checked> トップス</label>
          <label class="filter-option"><input type="checkbox"> ボトムス</label>
          <label class="filter-option"><input type="checkbox"> アクセサリー</label>
        </div>
      </div>

      <div class="filter-section">
        <div class="filter-title">ブランド</div>
        <div class="filter-options">
          <div class="filter-option">TRAVAS TOKYO</div>
          <div class="filter-option">REFLEM</div>
          <div class="filter-option">CIVARIZE</div>
          <div class="filter-option">BRI</div>
          <div class="filter-option">Amilige</div>
          <div class="filter-option">VOLCAN & APHRODITE</div>
          <div class="filter-option">THCC PSYYNXX</div>
          <div class="filter-option">KINGLYMASK</div>
          <div class="filter-option">QY</div>
          <div class="filter-option">Ark Rouge</div>
          <div class="filter-option">LIZ LISA</div>
          <div class="filter-option">Mars</div>
          <div class="filter-option">No - Brand</div>
          <div class="filter-option">その他</div>
        </div>
      </div>

      <div class="filter-section">
        <div class="filter-title">カラー</div>
        <div class="filter-options">
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#fff;border:2px solid #ddd;"></div>ホワイト
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#000;"></div>ブラック
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#808080;"></div>グレー
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#8B4513;"></div>ブラウン
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#00FF00;"></div>グリーン
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#0000FF;"></div>ブルー
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#800080;"></div>パープル
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#FFFF00;"></div>イエロー
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#FFC0CB;"></div>ピンク
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#FF0000;"></div>レッド
          </label>
          <label class="color-option">
            <input type="checkbox">
            <div class="color-circle" style="background:#FFA500;"></div>オレンジ
          </label>
        </div>
        <div class="filter-btn">
          <button onclick="clearFilter()">クリア</button>
          <button onclick="applyFilter()">OK</button>
        </div>
      </div>

      <div class="filter-section">
        <div class="filter-title">価格</div>
        <div class="price-filter">
          <input type="number" value="0" min="0"><span>円</span><span>〜</span>
          <input type="number" value="100000" min="0"><span>円</span>
        </div>
        <div class="filter-btn">
          <button onclick="clearPrice()">クリア</button>
          <button onclick="applyPrice()">OK</button>
        </div>
      </div>
    </aside>
    <main class="main-content">
      <h1 class="page-title">
        {% if search_query %}
          "{{ search_query }}" の検索結果 
        {% else %}
          全商品 
        {% endif %}
        ({{ products | length }} 件)
      </h1>
      
      <div class="product-grid" id="productGrid">
        {% for product in products %}
        <div class="product-card" onclick="window.location.href = '/products/{{ product.id }}'">
          <div class="product-image">
            <img src="{{ url_for('static', filename='img/productImg/' + (product.img if product.img else 'default.png')) }}" alt="{{ product.name }}">
          </div>
          <div class="product-brand">{{ product.brand }}</div>
          <div class="product-name">{{ product.name }}</div>
          <div class="product-price">¥{{ product.price }}</div>
        </div>
        {% endfor %}
        
        {% if not products %}
        <p>該当する商品が見つかりませんでした。</p>
        {% endif %}
      </div>
      
      <!-- page button -->
      <div class="pagination">
        {% if current_page > 1 %}
          <a class="page-arrow" href="?keyword={{ search_query }}&page={{ current_page - 1 }}">&lt;</a>
        {% endif %}

        {% for i in range(1, total_pages + 1) %}
          {% if i == current_page %}
            <div class="page-number active">{{ i }}</div>
          {% else %}
            <a class="page-number" href="?keyword={{ search_query }}&page={{ i }}">{{ i }}</a>
          {% endif %}
        {% endfor %}

        {% if current_page < total_pages %}
          <a class="page-arrow" href="?keyword={{ search_query }}&page={{ current_page + 1 }}">&gt;</a>
        {% endif %}
      </div>
    </main>
  </div>

  <script>
    // ⚠ 注意: generateProducts() は削除します。商品カードはサーバー側で生成されました。
    /*
    function generateProducts() {
        // ... (省略)
    }
    generateProducts();
    */

    // フィルター機能
    function clearFilter() {
      // 全てのチェックボックス/ラジオボタンをクリア
      document.querySelectorAll('.filter-options input').forEach(i => i.checked = false);
      // 種別のラジオボタン（ユニセックス）はデフォルトでチェックを戻す (元のHTML設定に基づく)
      document.querySelector('input[name="type"]').checked = true;
    }

    function applyFilter() {
      // 実際には、サイドバーの全フィルター条件を取得し、
      // /search_result エンドポイントにGETリクエストとして送信する処理を実装します。
      alert('フィルターを適用しました (検索処理を実行してください)');
    }

    function clearPrice() {
      const inputs = document.querySelectorAll('.price-filter input');
      inputs[0].value = 0;
      inputs[1].value = 100000;
    }

    function applyPrice() {
      // 実際には、価格フィルター条件をサーバーに送信する処理を実装します。
      alert('価格フィルターを適用しました (検索処理を実行してください)');
    }

    // ページネーションのインタラクション
    document.querySelectorAll('.page-number').forEach(page => {
      page.addEventListener('click', function () {
        document.querySelectorAll('.page-number').forEach(p => p.classList.remove('active'));
        this.classList.add('active');
        document.querySelector('.main-content').scrollTo({ top: 0, behavior: 'smooth' });
        // 実際のページ遷移またはAJAXコンテンツ読み込み処理を追加
      });
    });

    document.querySelector('.page-arrow').addEventListener('click', function () {
      const active = document.querySelector('.page-number.active');
      const next = active.nextElementSibling;
      if (next && next.classList.contains('page-number')) {
        active.classList.remove('active');
        next.classList.add('active');
        document.querySelector('.main-content').scrollTo({ top: 0, behavior: 'smooth' });
      }
    });
  </script>







{% endblock %}


