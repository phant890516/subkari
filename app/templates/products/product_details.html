{% extends "base.html" %}
{% block title %}
商品詳細ページ
{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/product_details.css') }}">
<div class="container">
    <div class="product-main">
        <div class="product-images">
            <div class="main-image-container">
                <img id="mainImage" src="{{url_for('static',filename='img/productImg/'+  (images[0].img if images and images.img else 'default.png'))}}" alt="スライド">
                <button class="nav-arrow left" onclick="changeImage(-1)">‹</button>
                <button class="nav-arrow right" onclick="changeImage(1)">›</button>
            </div>
            
            <div class="thumbnail-list">
                {% if images %}
                    {% for image in images %}
                        <img class="thumbnail" 
                            src="{{url_for('static', filename='img/productImg/' + image.img)}}" 
                            alt="サムネイル"
                            onclick="selectImage(this)">
                    {% endfor %}
                {% else %}
                    <img class="thumbnail" 
                        src="{{url_for('static', filename='img/productImg/default.png')}}" 
                        alt="デフォルト画像">
                {% endif %}
            </div>
        </div>
        <div class="product-info">
            <h1 class="product-title">{{ product.product_name }}</h1>
            <div class="price-section">
                {% if product.purchaseFlg == 1 %}
                
                <div class="price-row">
                    <span>購入価格</span>
                    <span class="price">{{ product.purchasePrice }}円<span style="font-size:14px; font-weight:normal;">
                            送料込み</span></span>
                </div>
                {% endif %}
                
                {% if product.rentalFlg == 1 %}
                {% if calculated_prices %}
                {% for period_text, total_price in calculated_prices.items() %}
                <div class="price-row">
                    <span>レンタル価格</span>
                    <span class="price">{{ period_text }}：</span>
                    <span class="price">{{ product.rentalPrice }}円<span style="font-size:14px; font-weight:normal;">
                            送料込み</span></span>
                            </div>
                {% endfor %}
                {% endif %}
                {% endif %}
            </div>
            <div class="action-buttons cursor-pointer">
                {%if product.condition != '取引中' and product.condition != '売却済み' %}
                    {% if product.purchaseFlg == 1 %}

                    <a href="{{url_for('products.purchase', product_id=product.id)}}">
                    <button class="btn">購入する</button>
                    </a>
                    {% endif %}
                    
                    {% if product.rentalFlg == 1 %}
                    <a href="{{url_for('products.rental', product_id=product.id)}}">
                        <button class="btn">レンタル</button>
                    </a>
                    {% endif %}
                {%endif%}
            </div>
            {%if product.condition == '取引中' or product.condition == '売却済み' %}
            <div class="error-message">
                <div class="error-icon">⚠️</div>
                <div class="error-text">
                    <p class="error-title">現在この商品は利用できません</p>
                    <p class="error-description">購入もレンタルも現在ご利用いただけません。</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="tabs">
        <button class="tab active" onclick="switchTab(0)">アイテム説明</button>
        <button class="tab" onclick="switchTab(1)">商品概要</button>
        <button class="tab" onclick="switchTab(2)">サイズ概要</button>
        <button class="tab" onclick="switchTab(3)">コメント</button>

    </div>
    <div class="tab-content active" id="tab0">
        <p>{{ product.explanation }}</p>
    </div>
    <div class="tab-content" id="tab1">
        <p><strong>系統カラー:</strong> {{ product.color}}<br>
            <strong>ジェンダーカテゴリ:</strong>{{ product.for}}<br>
            <strong>アイテムカテゴリ:</strong>{{ product.category_name}}<br>
            <strong>ブランド:</strong> {{ product.brand_name}}
        </p>
    </div>
    <div class="tab-content" id="tab2">
        {% if topSize %}
        <p><strong>肩幅:</strong> {{topSize.shoulderWidth}}<br>
            <strong>身幅:</strong> {{topSize.bodyWidth}}<br>
            <strong>そで丈:</strong>{{topSize.sleeveLength}}<br>
            <strong>着丈:</strong> {{topSize.bodyLength}}<br>
            <strong>サイズ備考欄:</strong> {{topSize.notes}}
        </p>
        {% endif %}
        {% if bottomsSize %}

        <p><strong>ヒップ:</strong> {{bottomsSize.hip}}<br>
            <strong>パンツ丈:</strong> {{bottomsSize.totalLength}}<br>
            <strong>股上:</strong>{{bottomsSize.rise}}<br>
            <strong>股下:</strong> {{bottomsSize.inseam}}<br>
            <strong>ウエスト:</strong> {{bottomsSize.waist}}<br>
            <strong>もも周り:</strong> {{bottomsSize.thighWidth}}<br>
            <strong>スソ周り:</strong> {{bottomsSize.hemWidth}}<br>
            <strong>スカート丈:</strong> {{bottomsSize.skirtLength}}<br>
            <strong>サイズ備考欄:</strong> {{bottomsSize.notes}}
        </p>
        {% endif %}
    </div>


    <div class="tab-content" id="tab3">
        {% for comment in comments %}
        <div class="comment-item">
            <div class="comment-avatar"></div>
            <div class="comment-content">
                <div class="comment-header">
                    <!-- <a href="{{url_for('userprf.userprf')}}" class="comment-link"></a> -->
                    <span class="comment-name">{{ comment.user_name }}</span>
                    {% if comment.is_seller %}
                    <span class="seller-badge">出品者</span>
                    {% endif %}
                    </a>
                </div>
                <div class="comment-text">{{ comment.text }}</div>
            </div>
        </div>
        {% endfor %}
        <form method="POST" action="{{ url_for('products.submit_comment', product_id=product.id) }}">
        <div class="comment-form">
            <input type="text" class="comment-input" name = "comment_text" placeholder="商品について質問や気になることがコメントしてください。">
            <button class="submit-btn">投稿</button>     
        </div>
        </form>
    </div>
    
    <div class="seller-info">
        <div class="seller-header">
            <div class="seller-details">
                <div class="seller-avatar"></div>
                <div>
                    <div class="seller-name">{{ seller_info.username }}</div>
                    <span class="stars">
                    {% for i in range(evaluation)%}★{% endfor %}
                    {% for i in range(5-evaluation)%}☆{% endfor %}</span>
                    <span class="rating-count">{{evaluationCount}}</span>

                    <!-- <div class="rating">★ 4.3</div> -->
                </div>
            </div>
            {% if not user_id == product.account_id %}
            {% if connection.type == 'フォロー' %}
            <button class="follow-btn">フォロー済み</button>
            {% endif %}
            {% if connection.type != 'フォロー' or not connection  %}
            <form method="POST" action="{{ url_for('products.follow', seller_id=product.account_id) }}">
            <button class="follow-btn">フォロー</button>
            </form>
            
            {% endif %}
            {% endif %}
        </div>
    </div>
    <div class="section-title">この出品者の他のアイテム</div>
    <div class="item-grid">
        {% for other_product in other_products_images %}
        <div class="item-card">
                <a href="{{ url_for('products.product_details_stub', product_id=other_product.product_id) }}">
                <img class="thumbnail" src="{{url_for('static', filename='img/productImg/' + other_product.first_image)}}" alt="other_product.product_name">
                </a>
                
        </div>
        {% endfor %}
        <!-- <div class="item-card">
                <img class="thumbnail" src="{{ url_for('static', filename='img/image 43.png') }}" alt="スライド">
        </div>
        <div class="item-card">
                <img class="thumbnail" src="{{ url_for('static', filename='img/image 43.png') }}" alt="スライド">
        </div>
        <div class="item-card">
                <img class="thumbnail" src="{{ url_for('static', filename='img/image 43.png') }}" alt="スライド">
        </div> -->
    </div>
    <div class="section-title">おすすめアイテム</div>
    <p>{{ logic_name }}</p>
    <div class="item-grid">
        {% if recommended_products %}
        {% for item in recommended_products %}
        <div class="item-card">
            <a href="{{ url_for('products.product_details_stub', product_id=item.product_id) }}">
                <img class="thumbnail" src="{{url_for('static', filename='img/productImg/' + item.first_image)}}" alt="スライド">
            </a>
            <div class="item-title">{{ item.name }}</div>
            {% if item.purchaseFlg == 1 %}
            <div class="item-price">購入 : ￥{{ item.purchasePrice }}</div>
            {% endif %}
            {% if item.rentalFlg == 1 %}
            <div class="item-price">レンタル : ￥{{ item.rentalPrice }}</div>
            {% endif %}
        </div>
        {% endfor %}
        {% else %}
        <p>おすすめ商品はありません。</p>
        {% endif %}
        <!-- <div class="item-card">
                <img class="thumbnail" src="{{ url_for('static', filename='img/image 43.png') }}" alt="スライド">
            <div class="item-title">出品タイトル</div>
            <div class="item-price">¥●●●●●</div>
        </div>
        <div class="item-card">
                <img class="thumbnail" src="{{ url_for('static', filename='img/image 43.png') }}" alt="スライド">
            <div class="item-title">出品タイトル</div>
            <div class="item-price">¥●●●●●</div>
        </div>
        <div class="item-card">
                <img class="thumbnail" src="{{ url_for('static', filename='img/image 43.png') }}" alt="スライド">
            <div class="item-title">出品タイトル</div>
            <div class="item-price">¥●●●●●</div>
        </div> -->
    </div>
</div>
<script src="{{ url_for('static', filename='js/product_details.js') }}"></script>
{% endblock %}